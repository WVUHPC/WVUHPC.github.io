

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Singularity Containers &mdash; WVU-RC 1.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="next" title="Singularity Containers" href="42.SingularityContainers.html" />
    <link rel="prev" title="Conda and BioConda" href="41.Conda.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> WVU-RC
          

          
            
            <img src="../_static/ResearchComputing.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="10.Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="20.QuickStart.html">Quick Start</a></li>
<li class="toctree-l1"><a class="reference internal" href="30.BasicUser.html">For Basic Users</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="40.AdvancedUser.html">For Advanced Users</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="41.Conda.html">Conda and BioConda</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="">Singularity Containers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#how-to-use-a-singularity-image">How to use a singularity Image</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#interactive-job">Interactive Job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#job-submission">Job Submission</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#central-installed-singularity-images">Central Installed Singularity Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#keras-2-4-tensorflow-1-5-with-gpu-support">Keras 2.4 + TensorFlow 1.5 with GPU support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#rstudio-desktop-1-1-with-r-3-4-3">RStudio Desktop 1.1 with R 3.4.3</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stacks-2-1">Stacks 2.1</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tensorflow-official-version-with-gpu-support">TensorFlow Official version with GPU support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#visit-2-13-2">Visit 2.13.2</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="42.SingularityContainers.html">Singularity Containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="43.UserInstallation.html">Installing Packages in User Locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="44.Miniconda.html">Miniconda</a></li>
<li class="toctree-l2"><a class="reference internal" href="45.MPIUser.html">Using MPI on RC HPC Clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="46.Hadoop.html">Executing HADOOP jobs</a></li>
<li class="toctree-l2"><a class="reference internal" href="47.Python.html">Python Modules</a></li>
<li class="toctree-l2"><a class="reference internal" href="48.Python.html">Python and scientific libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="48.Pythonvenv.html">Python Virtual Environments</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="50.Developers.html">For Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="60.Administrators.html">For Administrators</a></li>
<li class="toctree-l1"><a class="reference internal" href="70.DomainSpecific.html">Domain Specific Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="80.ClusterSpecific.html">Clusters Specifications</a></li>
<li class="toctree-l1"><a class="reference internal" href="90.References.html">References</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">WVU-RC</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="40.AdvancedUser.html">For Advanced Users</a> &raquo;</li>
        
      <li>Singularity Containers</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/text/42.Singularity.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="singularity-containers">
<h1>Singularity Containers<a class="headerlink" href="#singularity-containers" title="Permalink to this headline">¶</a></h1>
<p>Containers are a software technology that allows us to keep control of
the environment where a given code runs. Consider for example that you
want to run a code in such a way the same code runs on several machines
or clusters ensuring that the same libraries are loaded and the same
general environment is present. Different clusters could come installed
with different compilers, different Linux distributions and different
libraries in general. Containers can be used to package entire
scientific workflows, software and libraries, and even data and move
them to several compute infrastructures with complete reproducibility.</p>
<p>Containers are similar to Virtual Machines, however, the differences are
enough to consider them different technologies and those differences are
very important for HPC. Virtual Machines takes up a lot of system
resources. Each Virtual Machine (VM) runs not just a full copy of an
operating system, but a virtual copy of all the hardware that the
operating system needs to run. This quickly adds up to a lot of precious
RAM and CPU cycles, valuable resources for HPC.</p>
<p>In contrast, all that a container requires is enough of an operating
system, supporting programs and libraries, and system resources to run a
specific program. From the user perspective, a container is in most
cases a single file that contains the file system, ie a rather complete
Unix filesystem tree with all libraries, executables, and data that are
needed for a given workflow or scientific computation.</p>
<p>There are several container solutions, one prominent example is Docker,
however, the main issue with containers is security, despite the name,
containers do not actually contain the powers of the user who executes
code on them. That is why you do not see Docker installed on an HPC
cluster. Using dockers requires superuser access something that on
shared resources like an HPC cluster is not widely offered.</p>
<p>Singularity offers an alternative solution to Docker, users can run the
prepared images that we are offering on Spruce or bring their own.</p>
<p>For more information about Singularity and complete documentation see:
<a class="reference external" href="https://singularity.lbl.gov/quickstart">https://singularity.lbl.gov/quickstart</a></p>
<div class="section" id="how-to-use-a-singularity-image">
<h2>How to use a singularity Image<a class="headerlink" href="#how-to-use-a-singularity-image" title="Permalink to this headline">¶</a></h2>
<p>There are basically two scenarios, interactive execution and job
submission.</p>
<div class="section" id="interactive-job">
<h3>Interactive Job<a class="headerlink" href="#interactive-job" title="Permalink to this headline">¶</a></h3>
<p>If you are using Visit or RStudio, programs that uses the X11
forwarding, ensure to connect first to the cluster with X11 forwarding,
before asking for an interactive job. In order to connect into Spruce
with X11 forwarding use:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ssh -X &lt;username&gt;@spruce.hpc.wvu.edu
</pre></div>
</div>
<p>Once you have login into the cluster, create an interactive job with the
following command line, in this case we are using standby as queue but
any other queue is valid.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>qsub -X -I -q standby
</pre></div>
</div>
<p>Once you get inside a compute node, load the module:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>module load singularity/2.5.1
</pre></div>
</div>
<p>After loading the module the command singularity is available for usage,
and you can get a shell inside the image with:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>singularity shell /shared/software/containers/&lt;Image Name&gt;
</pre></div>
</div>
</div>
<div class="section" id="job-submission">
<h3>Job Submission<a class="headerlink" href="#job-submission" title="Permalink to this headline">¶</a></h3>
<p>In this case you do not need to export X11, just login into Spruce</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>ssh &lt;username&gt;@spruce.hpc.wvu.edu
</pre></div>
</div>
<p>Once you have login into the cluster, create a submission script
(&#8220;runjob.pbs&#8221; for this example), in this case we are using standby as
queue but any other queue is valid.</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#!/bin/sh

#PBS -N JOB
#PBS -l nodes=1:ppn=1
#PBS -l walltime=04:00:00
#PBS -m ae
#PBS -q standby

module load singularity/2.5.1

singularity exec /shared/software/containers/&lt;Image Name&gt; &lt;command_or_script_to_run&gt;
</pre></div>
</div>
<p>Submit your job with</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>qsub runjob.pbs
</pre></div>
</div>
</div>
</div>
<div class="section" id="central-installed-singularity-images">
<h2>Central Installed Singularity Images<a class="headerlink" href="#central-installed-singularity-images" title="Permalink to this headline">¶</a></h2>
<p>Currently, we are offering the following Images on Spruce, these images
were created to bind the shared folders that we currently offer on
Spruce (/users, /gpfs, /group and /scratch). The recipes allows
verifying how each of those images were created and give you a template
for creating your own. Notice that in order to create a Singularity
image you need root access, so you need to install Singularity on your
own computer to create the image there and transfer the created image
file back to Spruce.</p>
<div class="section" id="keras-2-4-tensorflow-1-5-with-gpu-support">
<h3>Keras 2.4 + TensorFlow 1.5 with GPU support<a class="headerlink" href="#keras-2-4-tensorflow-1-5-with-gpu-support" title="Permalink to this headline">¶</a></h3>
<p>Keras is a high-level neural networks API, written in Python and capable
of running on top of TensorFlow, CNTK, or Theano. It was developed with
a focus on enabling fast experimentation. Being able to go from idea to
result with the least possible delay is key to doing good research.</p>
<p><strong>Webpage:</strong> <a class="reference external" href="https://keras.io">https://keras.io</a></p>
<p><strong>Image Name:</strong> Keras-2.1.4_TensorFlow-1.5.0.simg</p>
<p><strong>Recipe:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Bootstrap: docker
From: gw000/keras-full

%environment
SHELL=/bin/bash
export SHELL
VARIABLE=HELLO-CUDA-EXAMPLE
export VARIABLE

%labels
AUTHOR gufranco@mail.wvu.edu

%post
. /environment
echo &#39;SHELL=/bin/bash&#39; &gt;&gt; /environment
chmod +x /environment
mkdir -p /users
mkdir -p /group
mkdir -p /gpfs
mkdir -p /data
mkdir -p /scratch
touch /usr/bin/nvidia-smi

%files
hello.cu        # copied to root of container
hello
Keras-2.1.4_TensorFlow-1.5.0.bst
</pre></div>
</div>
</div>
<div class="section" id="rstudio-desktop-1-1-with-r-3-4-3">
<h3>RStudio Desktop 1.1 with R 3.4.3<a class="headerlink" href="#rstudio-desktop-1-1-with-r-3-4-3" title="Permalink to this headline">¶</a></h3>
<p>RStudio is an integrated development environment (IDE) for R. It
includes a console, syntax-highlighting editor that supports direct code
execution, as well as tools for plotting, history, debugging and
workspace management.</p>
<p><strong>Webpage:</strong> <a class="reference external" href="https://www.rstudio.com/products/RStudio">https://www.rstudio.com/products/RStudio</a></p>
<p><strong>Image Name:</strong> RStudio-desktop-1.1.423_R-3.4.3.simg</p>
<p><strong>Recipe:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Bootstrap: shub
From: jekriske/rstudio:1.1.423_desktop

%runscript
exec echo &quot;The runscript is the containers default runtime command!&quot;

%files
RStudio-desktop-1.1.423_R-3.4.3.bst

%environment
SHELL=/bin/bash
export SHELL

%labels
AUTHOR gufranco@mail.wvu.edu

%post
mkdir /scratch
mkdir /users
mkdir /group
mkdir /gpfs
touch /usr/bin/nvidia-smi
</pre></div>
</div>
</div>
<div class="section" id="stacks-2-1">
<h3>Stacks 2.1<a class="headerlink" href="#stacks-2-1" title="Permalink to this headline">¶</a></h3>
<p>Stacks is a software pipeline for building loci from short-read
sequences, such as those generated on the Illumina platform. Stacks was
developed to work with restriction enzyme-based data, such as RAD-seq,
for the purpose of building genetic maps and conducting population
genomics and phylogeography.</p>
<p><strong>Webpage:</strong> <a class="reference external" href="http://catchenlab.life.illinois.edu/stacks/">http://catchenlab.life.illinois.edu/stacks/</a></p>
<p><strong>Image Name:</strong> Stacks-2.1.simg</p>
<p><strong>Recipe:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>Bootstrap: docker
From: ubuntu:trusty-20170817

%help
A Singularity image for Stacks v2.1

%labels
AUTHOR gufranco@mail.wvu.edu
Maintainer Guillermo Avendano Franco
Stacks v2.1

%environment
SELL=/bin/bash
export SHELL

%post
STACKS_VERSION=2.1

sudo locale-gen en_US.UTF-8
sudo update-locale

sudo apt-get --yes update
sudo apt-get --yes install build-essential autoconf automake wget git zlib1g-dev libbz2-dev libncurses5-dev curl unzip
sudo apt-get --yes install libdbd-mysql-perl

sudo apt-get --yes install software-properties-common
sudo add-apt-repository --yes ppa:ubuntu-toolchain-r/test
sudo apt-get --yes update
sudo apt-get --yes install g++-4.9

cd /tmp

echo &quot;Installing Stacks&quot;
STACKS_URL=&quot;http://catchenlab.life.illinois.edu/stacks/source/stacks-${STACKS_VERSION}.tar.gz&quot;
STACKS_ZIP=stacks.tar.gz
wget -O ${STACKS_ZIP} &quot;${STACKS_URL}&quot;
tar xf ${STACKS_ZIP}
cd stacks-${STACKS_VERSION}
CC=gcc-4.9 CXX=g++-4.9 ./configure
make -j4
sudo make install
sudo mkdir /tests
sudo mv tests/* /tests

echo &quot;Sorting some env variables...&quot;
sudo echo &#39;LANGUAGE=&quot;en_US:en&quot;&#39; &gt;&gt; $SINGULARITY_ENVIRONMENT
sudo echo &#39;LC_ALL=&quot;en_US.UTF-8&quot;&#39; &gt;&gt; $SINGULARITY_ENVIRONMENT
sudo echo &#39;LC_CTYPE=&quot;UTF-8&quot;&#39; &gt;&gt; $SINGULARITY_ENVIRONMENT
sudo echo &#39;LANG=&quot;en_US.UTF-8&quot;&#39; &gt;&gt;  $SINGULARITY_ENVIRONMENT

echo &quot;Done&quot;
mkdir /data
mkdir /scratch
mkdir /users
mkdir /group
mkdir /gpfs
touch /usr/bin/nvidia-smi

%runscript
echo &quot;Welcome to STACKS 2.1&quot; &gt;&amp;2
exec &quot;$@&quot;

%files
Stacks-2.1.bst

%test
echo &quot;Testing STACKS&quot;
#for testfile in $(ls /tests/*.t);
#do
#bash ${testfile};
#done
</pre></div>
</div>
</div>
<div class="section" id="tensorflow-official-version-with-gpu-support">
<h3>TensorFlow Official version with GPU support<a class="headerlink" href="#tensorflow-official-version-with-gpu-support" title="Permalink to this headline">¶</a></h3>
<p>TensorFlow™ is an open source software library for high-performance
numerical computation. Originally developed by researchers and engineers
from the Google Brain team within Google’s AI organization, it comes
with strong support for machine learning and deep learning and the
flexible numerical computation core is used across many other scientific
domains.</p>
<p>The image included, comes from the official dockers repository running
on Python 3 and supporting GPUs</p>
<p><strong>Webpage:</strong> <a class="reference external" href="https://www.tensorflow.org">https://www.tensorflow.org</a></p>
<p><strong>Image Name:</strong> TensorFlow_gpu_py3.simg</p>
<p><strong>Recipe:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span>#####################################################################
# Tensor Flow Container                                             #
# =====================                                             #
#                                                                   #
# This container provides Tensor Flow as imported                   #
# from the official Dockers container                               #
#                                                                   #
# singularity build TensorFlow_gpu_py3.simg TensorFlow_gpu__py3.bst #
#                                                                   #
#####################################################################

Bootstrap: docker
From: tensorflow/tensorflow:latest-gpu-py3

%runscript
exec echo &quot;The runscript is the containers default runtime command!&quot;

%files
TensorFlow_gpu_py3.bst

%environment
SELL=/bin/bash
export SHELL

%labels
AUTHOR gufranco@mail.wvu.edu

%post
echo &quot;The post section is where you can install, and configure your container.&quot;
#apt-get update &amp;&amp; apt-get -y upgrade
mkdir /data
mkdir /gpfs
mkdir /users
mkdir /group
mkdir /scratch
touch /usr/bin/nvidia-smi
</pre></div>
</div>
</div>
<div class="section" id="visit-2-13-2">
<h3>Visit 2.13.2<a class="headerlink" href="#visit-2-13-2" title="Permalink to this headline">¶</a></h3>
<p>VisIt is an Open Source, interactive, scalable, visualization, animation
and analysis tool. From Unix, Windows or Mac workstations, users can
interactively visualize and analyze data ranging in scale from small
(&lt;101 core) desktop-sized projects to large (&gt;105 core) leadership-class
computing facility simulation campaigns. Users can quickly generate
visualizations, animate them through time, manipulate them with a</p>
<p>variety of operators and mathematical expressions, and save the
resulting images and animations for presentations. VisIt contains a rich
set of visualization features to enable users to view a wide variety of
data including scalar and vector fields defined on two- and
three-dimensional (2D and 3D) structured, adaptive and unstructured
meshes. Owing to its customizeable plugin design, VisIt is capabable of
visualizing data from over 120 different scientific data formats.</p>
<p><strong>Webpage:</strong> <a class="reference external" href="https://wci.llnl.gov/simulation/computer-codes/visit">https://wci.llnl.gov/simulation/computer-codes/visit</a></p>
<p><strong>Image Name:</strong> Visit-2.13.2.simg</p>
<p><strong>Recipe:</strong></p>
<div class="highlight-python"><div class="highlight"><pre><span></span># Singularity container with Visit 2.13.2
#
# This is the Bootstrap file to recreate the image.
#

Bootstrap: docker
From: ubuntu:trusty

%runscript
exec echo &quot;The runscript is the containers default runtime command!&quot;

%files
Visit-2.13.2.bst

%environment
SHELL=/bin/bash
export SHELL
PATH=/data/visit2_13_2.linux-x86_64/bin:$PATH
export PATH

%labels
AUTHOR gufranco@mail.wvu.edu

%post
echo &quot;The post section is where you can install, and configure your container.&quot;
apt-get update &amp;&amp; apt-get -y install x11-apps wget emacs libgl1-mesa-dev
mkdir -p /data
mkdir -p /gpfs
mkdir -p /users
mkdir -p /group
mkdir -p /scratch
touch /usr/bin/nvidia-smi

cd /data &amp;&amp; wget http://portal.nersc.gov/project/visit/releases/2.13.2/visit2_13_2.linux-x86_64-ubuntu14.tar.gz
cd /data &amp;&amp; tar -zxvf visit2_13_2.linux-x86_64-ubuntu14.tar.gz
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="42.SingularityContainers.html" class="btn btn-neutral float-right" title="Singularity Containers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="41.Conda.html" class="btn btn-neutral" title="Conda and BioConda" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Guillermo Avendano-Franco

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript">
          var DOCUMENTATION_OPTIONS = {
              URL_ROOT:'../',
              VERSION:'1.0',
              LANGUAGE:'',
              COLLAPSE_INDEX:false,
              FILE_SUFFIX:'.html',
              HAS_SOURCE:  true,
              SOURCELINK_SUFFIX: ''
          };
      </script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
    

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>